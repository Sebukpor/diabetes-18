<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diabetes Risk Assessment Tool</title>
  <!-- TensorFlow.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4CAF50;
      --primary-dark: #388E3C;
      --primary-light: #C8E6C9;
      --secondary: #2196F3;
      --danger: #F44336;
      --danger-dark: #D32F2F;
      --warning: #FF9800;
      --warning-dark: #F57C00;
      --light: #F5F7FA;
      --dark: #263238;
      --gray: #607D8B;
      --gray-light: #CFD8DC;
      --white: #FFFFFF;
      --border-radius: 12px;
      --border-radius-sm: 8px;
      --box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
      --box-shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.05);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
      color: var(--dark);
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      max-width: 1000px;
      width: 100%;
      background: var(--white);
      border-radius: var(--border-radius);
      padding: 40px;
      box-shadow: var(--box-shadow);
      position: relative;
      overflow: hidden;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: var(--dark);
      font-size: 2.2em;
      font-weight: 600;
      position: relative;
      padding-bottom: 15px;
    }

    h1::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 2px;
    }

    .form-section {
      margin-bottom: 25px;
      padding: 30px;
      background: var(--light);
      border-radius: var(--border-radius);
      border: 1px solid rgba(0, 0, 0, 0.05);
      transition: var(--transition);
    }

    .form-section:hover {
      box-shadow: var(--box-shadow-sm);
    }

    .form-section h3 {
      margin-bottom: 20px;
      color: var(--dark);
      font-size: 1.3em;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-section h3 i {
      color: var(--primary);
      font-size: 1.1em;
    }

    form {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    .form-group {
      position: relative;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark);
      font-size: 0.95em;
    }

    input, select {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--gray-light);
      border-radius: var(--border-radius-sm);
      font-size: 0.95em;
      transition: var(--transition);
      background: var(--white);
      color: var(--dark);
      font-family: 'Poppins', sans-serif;
    }

    input:focus, select:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
    }

    button {
      padding: 16px 24px;
      background: var(--primary);
      color: var(--white);
      border: none;
      border-radius: var(--border-radius-sm);
      font-size: 1em;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    button:hover:not(:disabled) {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }

    button:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      background: var(--gray-light);
    }

    .button-secondary {
      background: var(--gray-light);
      color: var(--dark);
    }

    .button-secondary:hover {
      background: var(--gray);
      color: var(--white);
    }

    .result-container {
      margin-top: 30px;
      padding: 30px;
      border-radius: var(--border-radius);
      text-align: center;
      font-size: 1.1em;
      display: none;
      animation: fadeIn 0.5s ease;
      border: 1px solid transparent;
      transition: var(--transition);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .diabetic {
      background: rgba(244, 67, 54, 0.1);
      border-color: rgba(244, 67, 54, 0.3);
      color: var(--danger-dark);
    }

    .prediabetic {
      background: rgba(255, 152, 0, 0.1);
      border-color: rgba(255, 152, 0, 0.3);
      color: var(--warning-dark);
    }

    .non-diabetic {
      background: rgba(76, 175, 80, 0.1);
      border-color: rgba(76, 175, 80, 0.3);
      color: var(--primary-dark);
    }

    .result-header {
      font-size: 1.5em;
      font-weight: 600;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .confidence-container {
      margin: 25px 0;
    }

    .confidence-labels {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.9em;
      color: var(--gray);
    }

    .confidence-bar {
      height: 12px;
      background: var(--gray-light);
      border-radius: 6px;
      overflow: hidden;
    }

    .confidence-fill {
      height: 100%;
      transition: width 0.8s cubic-bezier(0.22, 0.61, 0.36, 1);
      border-radius: 6px;
    }

    .confidence-value {
      margin-top: 15px;
      font-weight: 500;
      font-size: 1.1em;
    }

    .recommendations {
      margin-top: 25px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: var(--border-radius-sm);
      text-align: left;
      font-size: 0.95em;
      border-left: 4px solid var(--primary);
    }

    .recommendations h4 {
      margin-bottom: 15px;
      color: var(--dark);
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .recommendations ul {
      padding-left: 20px;
    }

    .recommendations li {
      margin-bottom: 8px;
      line-height: 1.6;
    }

    .tooltip {
      position: absolute;
      right: 12px;
      top: 38px;
      color: var(--gray);
      cursor: help;
      font-size: 0.9em;
      transition: var(--transition);
    }

    .tooltip:hover {
      color: var(--primary);
    }

    .input-icon {
      position: absolute;
      right: 15px;
      top: 38px;
      color: var(--gray);
      pointer-events: none;
    }

    .risk-categories {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }

    .risk-category {
      flex: 1;
      padding: 12px;
      border-radius: var(--border-radius-sm);
      text-align: center;
      font-size: 0.9em;
      font-weight: 500;
      background: var(--light);
      transition: var(--transition);
    }

    .risk-category.active {
      background: var(--primary);
      color: var(--white);
      box-shadow: 0 4px 8px rgba(76, 175, 80, 0.2);
    }

    .risk-category[data-risk="prediabetic"].active {
      background: var(--warning);
    }

    .risk-category[data-risk="diabetic"].active {
      background: var(--danger);
    }

    .form-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--gray-light);
    }

    .form-tab {
      padding: 12px 20px;
      cursor: pointer;
      font-weight: 500;
      color: var(--gray);
      border-bottom: 3px solid transparent;
      transition: var(--transition);
      position: relative;
    }

    .form-tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    .form-tab:hover:not(.active) {
      color: var(--dark);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .tab-content.active {
      display: block;
    }

    .progress-container {
      margin: 20px 0;
      display: none;
    }

    .progress-bar {
      height: 6px;
      background: var(--gray-light);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      transition: width 0.5s ease;
      border-radius: 3px;
    }

    .error-message {
      color: var(--danger);
      font-size: 0.85em;
      margin-top: 5px;
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .input-error {
      border-color: var(--danger) !important;
    }

    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 10px;
    }

    .button-group button {
      flex: 1;
    }

    .tooltip-box {
      position: absolute;
      background: var(--dark);
      color: var(--white);
      padding: 8px 12px;
      border-radius: var(--border-radius-sm);
      font-size: 0.8em;
      z-index: 1000;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      white-space: nowrap;
      box-shadow: var(--box-shadow-sm);
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .tooltip:hover .tooltip-box {
      opacity: 1;
    }

    .form-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .container {
        padding: 20px;
      }

      .form-section {
        padding: 20px;
      }

      form {
        grid-template-columns: 1fr;
      }

      h1 {
        font-size: 1.8em;
      }

      .risk-categories {
        flex-direction: column;
      }

      .form-tabs {
        overflow-x: auto;
        white-space: nowrap;
        padding-bottom: 5px;
      }

      .form-tab {
        padding: 10px 15px;
        font-size: 0.9em;
      }

      .button-group {
        flex-direction: column;
      }
    }

    /* Loading spinner animation */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .fa-spinner {
      animation: spin 1s linear infinite;
    }

    /* Floating notification */
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--primary);
      color: white;
      padding: 15px 20px;
      border-radius: var(--border-radius-sm);
      box-shadow: var(--box-shadow);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><i class="fas fa-heartbeat"></i> Diabetes Risk Assessment</h1>
    
    <div class="form-tabs">
      <div class="form-tab active" data-tab="basic">Demographics</div>
      <div class="form-tab" data-tab="clinical">Clinical Data</div>
      <div class="form-tab" data-tab="lifestyle">Lifestyle</div>
    </div>
    
    <div class="progress-container" id="progressContainer">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <div class="form-section">
      <form id="predictionForm" novalidate>
        <!-- Basic Information Tab -->
        <div class="tab-content active" id="basic-tab">
          <div class="form-group">
            <label for="age">Age (years)</label>
            <input type="number" min="21" max="120" step="1" id="age" required value="35">
            <div class="tooltip" title="Patient age in years (21 and above)"><i class="fas fa-info-circle"></i></div>
            <div class="error-message" id="age-error"></div>
          </div>
          <div class="form-group">
            <label for="gender">Gender</label>
            <select id="gender" required>
              <option value="" disabled selected>Select Gender</option>
              <option value="1">Female</option>
              <option value="2">Male</option>
            </select>
            <div class="error-message" id="gender-error"></div>
          </div>
          <div class="form-group">
            <label for="bmi">BMI (kg/mÂ²)</label>
            <input type="number" step="0.1" min="15" max="60" id="bmi" required value="24.5">
            <div class="tooltip" title="Body Mass Index (weight in kg divided by height in meters squared)"><i class="fas fa-info-circle"></i></div>
            <div class="error-message" id="bmi-error"></div>
          </div>
          <div class="form-group">
            <label for="sbp">Systolic BP (mmHg)</label>
            <input type="number" step="1" min="70" max="250" id="sbp" required value="120">
            <div class="tooltip" title="Systolic Blood Pressure (top number)"><i class="fas fa-info-circle"></i></div>
            <div class="error-message" id="sbp-error"></div>
          </div>
          <div class="form-group">
            <label for="dbp">Diastolic BP (mmHg)</label>
            <input type="number" step="1" min="40" max="150" id="dbp" required value="80">
            <div class="tooltip" title="Diastolic Blood Pressure (bottom number)"><i class="fas fa-info-circle"></i></div>
            <div class="error-message" id="dbp-error"></div>
          </div>
          <div class="form-navigation">
            <button type="button" class="next-tab" data-next="clinical">Continue <i class="fas fa-arrow-right"></i></button>
          </div>
        </div>
        
        <!-- Clinical Measurements Tab -->
        <div class="tab-content" id="clinical-tab">
          <div class="form-group">
            <label for="fpg">Fasting Plasma Glucose (mmol/L)</label>
            <input type="number" step="0.1" min="2" max="20" id="fpg" required value="5.0">
            <div class="tooltip" title="Blood sugar level after fasting for at least 8 hours"><i class="fas fa-info-circle"></i></div>
            <div class="error-message" id="fpg-error"></div>
          </div>
          <div class="form-group">
            <label for="chol">Total Cholesterol (mmol/L)</label>
            <input type="number" step="0.1" min="2" max="15" id="chol" required value="4.5">
            <div class="error-message" id="chol-error"></div>
          </div>
          <div class="form-group">
            <label for="tri">Triglycerides (mmol/L)</label>
            <input type="number" step="0.1" min="0.2" max="20" id="tri" required value="1.5">
            <div class="error-message" id="tri-error"></div>
          </div>
          <div class="form-group">
            <label for="hdl">HDL (High-Density Lipoprotein) (mmol/L)</label>
            <input type="number" step="0.1" min="0.2" max="5" id="hdl" required value="1.3">
            <div class="tooltip" title="High-Density Lipoprotein ('good' cholesterol)"><i class="fas fa-info-circle"></i></div>
            <div class="error-message" id="hdl-error"></div>
          </div>
          <div class="form-group">
            <label for="ldl">LDL (Low-Density Lipoprotein) (mmol/L)</label>
            <input type="number" step="0.1" min="0.5" max="10" id="ldl" required value="2.8">
            <div class="tooltip" title="Low-Density Lipoprotein ('bad' cholesterol)"><i class="fas fa-info-circle"></i></div>
            <div class="error-message" id="ldl-error"></div>
          </div>
          <div class="form-group">
            <label for="alt">ALT (Alanine Aminotransferase) (U/L)</label>
            <input type="number" step="1" min="5" max="500" id="alt" required value="25">
            <div class="tooltip" title="Alanine Aminotransferase (liver enzyme)"><i class="fas fa-info-circle"></i></div>
            <div class="error-message" id="alt-error"></div>
          </div>
          <div class="form-group">
            <label for="bun">BUN (Blood urea nitrogen) (mmol/L)</label>
            <input type="number" step="0.1" min="1" max="30" id="bun" required value="4.8">
            <div class="tooltip" title="Blood Urea Nitrogen (kidney function marker)"><i class="fas fa-info-circle"></i></div>
            <div class="error-message" id="bun-error"></div>
          </div>
          <div class="form-group">
            <label for="ccr">Creatinine Clearance (mL/min)</label>
            <input type="number" step="1" min="20" max="200" id="ccr" required value="90">
            <div class="tooltip" title="Measures how well kidneys filter creatinine from blood"><i class="fas fa-info-circle"></i></div>
            <div class="error-message" id="ccr-error"></div>
          </div>
          <div class="form-group">
            <label for="ffpg">Final Fasting Plasma Glucose (mmol/L)</label>
            <input type="number" step="0.1" min="2" max="20" id="ffpg" required value="5.2">
            <div class="error-message" id="ffpg-error"></div>
          </div>
          <div class="form-navigation">
            <button type="button" class="button-secondary prev-tab" data-prev="basic"><i class="fas fa-arrow-left"></i> Back</button>
            <button type="button" class="next-tab" data-next="lifestyle">Continue <i class="fas fa-arrow-right"></i></button>
          </div>
        </div>
        
        <!-- Lifestyle Factors Tab -->
        <div class="tab-content" id="lifestyle-tab">
          <div class="form-group">
            <label for="smoking">Smoking Status</label>
            <select id="smoking" required>
              <option value="" disabled selected>Select Smoking Status</option>
              <option value="1">Current Smoker</option>
              <option value="2">Former Smoker</option>
              <option value="3">Never Smoked</option>
            </select>
            <div class="error-message" id="smoking-error"></div>
          </div>
          <div class="form-group">
            <label for="drinking">Alcohol Consumption</label>
            <select id="drinking" required>
              <option value="" disabled selected>Select Drinking Status</option>
              <option value="1">Current Drinker</option>
              <option value="2">Former Drinker</option>
              <option value="3">Never Drinker</option>
            </select>
            <div class="error-message" id="drinking-error"></div>
          </div>
          <div class="form-group">
            <label for="family_history">Family History of Diabetes</label>
            <select id="family_history" required>
              <option value="" disabled selected>Select Option</option>
              <option value="1">Yes (parents or siblings)</option>
              <option value="0">No family history</option>
            </select>
            <div class="error-message" id="family_history-error"></div>
          </div>
          <div class="form-navigation">
            <button type="button" class="button-secondary prev-tab" data-prev="clinical"><i class="fas fa-arrow-left"></i> Back</button>
            <button type="submit" id="predictButton" disabled><i class="fas fa-heartbeat"></i> Assess Risk</button>
          </div>
        </div>
      </form>
    </div>
    
    <div class="result-container" id="result">
      <div class="result-header" id="resultIcon">
        <i class="fas fa-question-circle"></i>
        <span id="resultText">Assessment Result</span>
      </div>
      
      <div class="risk-categories">
        <div class="risk-category" data-risk="non-diabetic">Non-Diabetic</div>
        <div class="risk-category" data-risk="prediabetic">Pre-Diabetic</div>
        <div class="risk-category" data-risk="diabetic">Diabetic</div>
      </div>
      
      <div class="confidence-container">
        <div class="confidence-labels">
          <span>Low Risk</span>
          <span>High Risk</span>
        </div>
        <div class="confidence-bar">
          <div class="confidence-fill" id="confidenceBar"></div>
        </div>
        <div class="confidence-value" id="confidenceText">Confidence: --%</div>
      </div>
      
      <div class="recommendations" id="recommendations">
        <h4><i class="fas fa-lightbulb"></i> Recommendations</h4>
        <p>Complete the assessment to receive personalized recommendations.</p>
      </div>
    </div>
  </div>

  <div class="notification" id="notification"></div>

  <script>
    // Mean and scale values for normalization
    const meanValues = [48.0850569, 1.35161515, 24.1239228, 123.219382, 76.3604462, 5.22636765, 4.86075309, 1.57782911, 1.36169193, 2.80366509, 26.8006027, 4.84064942, 72.0840787, 5.72908436, 2.62338776, 2.86925911, 0.0615849407];
    const scaleValues = [14.68444811, 0.47747454, 3.39689946, 17.51182266, 11.00277729, 0.78099865, 0.92526973, 1.2459078, 0.3119531, 0.66397876, 22.2547717, 1.25141716, 15.85503172, 1.42440207, 0.76309691, 0.45237629, 0.24040016];

    let model;
    let modelLoaded = false;
    const resultDiv = document.getElementById("result");
    const predictButton = document.getElementById("predictButton");
    const progressContainer = document.getElementById("progressContainer");
    const progressFill = document.getElementById("progressFill");
    const notification = document.getElementById("notification");

    // Show notification
    function showNotification(message, type = 'info') {
      notification.textContent = message;
      notification.className = 'notification';
      
      // Set color based on type
      if (type === 'error') {
        notification.style.backgroundColor = 'var(--danger)';
      } else if (type === 'success') {
        notification.style.backgroundColor = 'var(--primary)';
      } else {
        notification.style.backgroundColor = 'var(--secondary)';
      }
      
      notification.classList.add('show');
      
      // Hide after 3 seconds
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Load the TensorFlow.js model
    async function loadModel() {
      try {
        // Show loading progress
        progressContainer.style.display = 'block';
        progressFill.style.width = '30%';
        
        // Simulate model loading (replace with actual model loading)
        // In a real implementation, you would load your actual model here
        // model = await tf.loadGraphModel("path/to/your/model.json");
        
        // For demonstration purposes, we'll simulate loading
        await new Promise(resolve => setTimeout(resolve, 800));
        progressFill.style.width = '60%';
        await new Promise(resolve => setTimeout(resolve, 800));
        progressFill.style.width = '90%';
        await new Promise(resolve => setTimeout(resolve, 400));
        
        // Complete progress bar
        progressFill.style.width = '100%';
        setTimeout(() => {
          progressContainer.style.display = 'none';
        }, 500);
        
        modelLoaded = true;
        predictButton.disabled = false;
        predictButton.innerHTML = '<i class="fas fa-heartbeat"></i> Assess Risk';
        showNotification('Model loaded successfully', 'success');
      } catch (error) {
        console.error("Error loading model:", error);
        progressFill.style.backgroundColor = 'var(--danger)';
        predictButton.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Model Failed to Load';
        showNotification('Failed to load model', 'error');
      }
    }

    // Normalize input values
    function normalizeInput(value, index) {
      return (value - meanValues[index]) / scaleValues[index];
    }

    // Validate form fields with better error handling
    function validateForm() {
      let allValid = true;
      const activeTab = document.querySelector('.tab-content.active');
      
      activeTab.querySelectorAll('input[required], select[required]').forEach(field => {
        const errorElement = document.getElementById(`${field.id}-error`);
        field.classList.remove('input-error');
        errorElement.style.display = 'none';
        
        if (!field.value) {
          showError(field, 'This field is required');
          allValid = false;
        } else if (field.type === 'number') {
          const value = parseFloat(field.value);
          if (isNaN(value)) {
            showError(field, 'Please enter a valid number');
            allValid = false;
          } else if (value < parseFloat(field.min)) {
            showError(field, `Value must be at least ${field.min}`);
            allValid = false;
          } else if (value > parseFloat(field.max)) {
            showError(field, `Value must be at most ${field.max}`);
            allValid = false;
          }
        }
      });
      
      // Only enable predict button if we're on the last tab and all is valid
      const isLastTab = document.querySelector('.tab-content.active').id === 'lifestyle-tab';
      predictButton.disabled = !(allValid && isLastTab);
      return allValid;
    }

    function showError(field, message) {
      field.classList.add('input-error');
      const errorElement = document.getElementById(`${field.id}-error`);
      errorElement.textContent = message;
      errorElement.style.display = 'block';
    }

    // Handle form submission
    async function predictOutcome(event) {
      event.preventDefault();
      
      if (!validateForm()) {
        return; // Don't proceed if validation fails
      }
      
      if (!modelLoaded) {
        showNotification("Model is still loading. Please wait...", 'error');
        return;
      }
      
      // Show loading state
      const originalButtonText = predictButton.innerHTML;
      predictButton.disabled = true;
      predictButton.innerHTML = '<i class="fas fa-spinner"></i> Analyzing...';
      
      try {
        const inputs = [
          parseFloat(document.getElementById("age").value),
          parseFloat(document.getElementById("gender").value),
          parseFloat(document.getElementById("bmi").value),
          parseFloat(document.getElementById("sbp").value),
          parseFloat(document.getElementById("dbp").value),
          parseFloat(document.getElementById("fpg").value),
          parseFloat(document.getElementById("chol").value),
          parseFloat(document.getElementById("tri").value),
          parseFloat(document.getElementById("hdl").value),
          parseFloat(document.getElementById("ldl").value),
          parseFloat(document.getElementById("alt").value),
          parseFloat(document.getElementById("bun").value),
          parseFloat(document.getElementById("ccr").value),
          parseFloat(document.getElementById("ffpg").value),
          parseFloat(document.getElementById("smoking").value),
          parseFloat(document.getElementById("drinking").value),
          parseFloat(document.getElementById("family_history").value)
        ];

        const normalizedInputs = inputs.map((val, idx) => normalizeInput(val, idx));
        // For demonstration, we'll simulate a prediction
        // In a real implementation, you would use your actual model:
        // const inputTensor = tf.tensor2d([normalizedInputs]);
        // const predictionTensor = model.predict(inputTensor);
        // const probability = await predictionTensor.data();
        
        // Simulate prediction with a random probability for demonstration
        await new Promise(resolve => setTimeout(resolve, 1500));
        const diabeticProb = Math.random(); // Replace with actual model prediction
        
        // Reset button state
        predictButton.disabled = false;
        predictButton.innerHTML = originalButtonText;
        
        // Display results with updated confidence score calculation
        displayResults(diabeticProb);
      } catch (error) {
        console.error("Prediction error:", error);
        
        // Reset button state
        predictButton.disabled = false;
        predictButton.innerHTML = originalButtonText;
        
        // Show error
        resultDiv.style.display = "block";
        resultDiv.className = "result-container diabetic";
        document.getElementById('resultText').textContent = "Error in Assessment";
        document.getElementById('confidenceText').textContent = error.message || "Please try again";
        document.getElementById('resultIcon').innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error in Assessment';
        showNotification('Assessment failed. Please try again.', 'error');
      }
    }

    function displayResults(diabeticProb) {
      resultDiv.style.display = "block";
      
      // Scroll to results smoothly
      resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      
      // Determine risk category and calculate confidence score
      let riskCategory, resultClass, resultIcon, resultText, confidenceScore;
      
      // Apply specified analogy for confidence calculation
      if (diabeticProb >= 0.70) {
        riskCategory = "diabetic";
        resultClass = "diabetic";
        resultIcon = "fas fa-exclamation-triangle";
        resultText = "High Diabetes Risk";
        confidenceScore = diabeticProb * 100; // 70-100% confidence in diabetic
      } else if (diabeticProb >= 0.40) {
        riskCategory = "prediabetic";
        resultClass = "prediabetic";
        resultIcon = "fas fa-info-circle";
        resultText = "Moderate Diabetes Risk";
        confidenceScore = diabeticProb * 100; // 40-69% confidence in prediabetic
      } else {
        riskCategory = "non-diabetic";
        resultClass = "non-diabetic";
        resultIcon = "fas fa-check-circle";
        resultText = "Low Diabetes Risk";
        confidenceScore = (1 - diabeticProb) * 100; // Confidence in being non-diabetic
      }

      const roundedConfidence = Math.round(confidenceScore);
      
      // Update result display
      resultDiv.className = `result-container ${resultClass}`;
      document.getElementById('resultText').textContent = resultText;
      document.getElementById('resultIcon').innerHTML = `<i class="${resultIcon}"></i> ${resultText}`;
      
      // Update risk category highlights
      document.querySelectorAll('.risk-category').forEach(cat => {
        cat.classList.remove('active');
        if (cat.dataset.risk === riskCategory) {
          cat.classList.add('active');
        }
      });
      
      // Update confidence meter
      const confidenceBar = document.getElementById('confidenceBar');
      confidenceBar.style.width = `${roundedConfidence}%`;
      confidenceBar.style.backgroundColor = getConfidenceColor(roundedConfidence);
      
      document.getElementById('confidenceText').textContent = 
        `Confidence: ${roundedConfidence}% ${riskCategory.replace('-', ' ')}`;
      
      // Update recommendations
      updateRecommendations(riskCategory, roundedConfidence);
      
      // Show success notification
      showNotification('Assessment completed successfully', 'success');
    }

    function getConfidenceColor(percentage) {
      if (percentage >= 70) return 'var(--danger)';      // Red for diabetic
      if (percentage >= 40) return 'var(--warning)';     // Orange for prediabetic
      return 'var(--primary)';                           // Green for non-diabetic
    }

    function updateRecommendations(category, percentage) {
      const recContainer = document.getElementById('recommendations');
      let html = '<h4><i class="fas fa-lightbulb"></i> Recommendations</h4><ul>';
      
      if (category === 'diabetic') {
        html += `
          <li><strong>Urgent medical consultation</strong> recommended (${percentage}% diabetic probability)</li>
          <li>Consider immediate <strong>HbA1c test</strong> for confirmation</li>
          <li>Implement lifestyle changes: diet modification and regular exercise</li>
          <li>Monitor blood glucose levels regularly</li>
          <li>Potential referral to endocrinologist</li>
        `;
      } else if (category === 'prediabetic') {
        html += `
          <li><strong>Medical evaluation</strong> recommended (${percentage}% prediabetic probability)</li>
          <li>Lifestyle changes can prevent progression to diabetes:
            <ul>
              <li>5-7% weight loss if overweight</li>
              <li>150+ minutes of exercise weekly</li>
              <li>Balanced diet with whole grains and vegetables</li>
            </ul>
          </li>
          <li>Annual diabetes screening advised</li>
        `;
      } else {
        html += `
          <li><strong>Maintain current healthy lifestyle</strong> (${percentage}% non-diabetic confidence)</li>
          <li>Routine screening every 3 years recommended</li>
          <li>Be aware of diabetes symptoms</li>
          <li>Maintain healthy weight and balanced diet</li>
        `;
      }
      
      html += '</ul>';
      recContainer.innerHTML = html;
    }

    // Tab navigation functionality
    document.querySelectorAll('.form-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.dataset.tab;
        
        // Update active tab
        document.querySelectorAll('.form-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Show corresponding content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(`${tabId}-tab`).classList.add('active');
        
        // Validate the new tab's fields
        validateForm();
      });
    });

    // Next button functionality
    document.querySelectorAll('.next-tab').forEach(button => {
      button.addEventListener('click', () => {
        const currentTab = document.querySelector('.tab-content.active');
        if (!validateForm()) {
          return; // Don't proceed if validation fails
        }
        const nextTab = button.dataset.next;
        document.querySelector(`.form-tab[data-tab="${nextTab}"]`).click();
        
        // Scroll to top of form section
        document.querySelector('.form-section').scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start' 
        });
      });
    });

    // Previous button functionality
    document.querySelectorAll('.prev-tab').forEach(button => {
      button.addEventListener('click', () => {
        const prevTab = button.dataset.prev;
        document.querySelector(`.form-tab[data-tab="${prevTab}"]`).click();
        
        // Scroll to top of form section
        document.querySelector('.form-section').scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start' 
        });
      });
    });

    // Real-time form validation
    document.querySelectorAll('input, select').forEach(field => {
      field.addEventListener('input', validateForm);
      field.addEventListener('change', validateForm);
    });

    // Form submission
    document.getElementById('predictionForm').addEventListener('submit', predictOutcome);

    // Initialize the app
    window.addEventListener('DOMContentLoaded', () => {
      // Set default values
      document.getElementById('gender').value = '1';
      document.getElementById('smoking').value = '3';
      document.getElementById('drinking').value = '3';
      document.getElementById('family_history').value = '0';
      
      // Load the model
      loadModel();
      
      // Initial validation
      validateForm();
    });

    // Add animation to confidence bar when it becomes visible
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const confidenceBar = document.getElementById('confidenceBar');
          confidenceBar.style.transition = 'width 1.5s ease-out';
        }
      });
    }, {threshold: 0.1});

    observer.observe(resultDiv);
  </script>
</body>
</html>
